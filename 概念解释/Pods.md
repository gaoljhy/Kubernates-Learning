# 名词解释 Pods

在Kubernetes中，最小的管理元素不是一个个独立的容器，而是`Pod`

`Pod`是最小的，**管理，创建，计划** 的最小单元.

> Pod 可以理解为是 一台虚拟化主机 ,上面可以存放多个容器

> > 不同于一般的容器在主机上运行,这些容器共享同一持久化Volume,拥有同一namespace下的不同PID ,可以直接通过IPC交互,且有同一个主机名称,同一 `ip`

> 区分开 docker中的容器

参考 <https://www.kubernetes.org.cn/kubernetes-pod>

## 什么是Pod

一个 `Pod` 相当于一个共享`context`的配置组

> 在同一个`context`下，**应用**可能还会有独立的`cgroup`隔离机制

一个`Pod`是一个容器环境下的**逻辑主机**

> 它可能包含一个或者多个紧密相连的应用，这些应用可能是在同一个物理主机或虚拟机上。

### context

Pod 的`context`可以理解成多个`linux`命名空间的联合

`PID` 命名空间（同一个`Pod`中应用可以看到其它进程）
`网络` 命名空间（同一个`Pod`的中的应用对相同的`IP`地址和端口有权限）
`IPC` 命名空间（同一个`Pod`中的应用可以通过`VPC`或者`POSIX`进行通信）
`UTS` 命名空间（同一个`Pod`中的应用共享一个主机名称）

同一个`Pod`中的应用可以共享磁盘，磁盘是`Pod`级的，应用可以通过文件系统调用

由于`docker`的架构，一个`Pod`是由多个相关的并且共享磁盘的容器组成

> Pid的命名空间共享还没有应用到`Docker`中

和相互独立的容器一样，`Pod`是一种相对短暂的存在，而不是持久存在的，正如在`Pod`的生命周期中提到的，`Pod`被安排到结点上，并且保持在这个节点上直到被终止（根据重启的设定）或者被删除，当一个节点死掉之后，上面的所有`Pod`均会被删除。

特殊的Pod永远不会被转移到的其他的节点，作为替代，他们必须被replace.

## Pod的发展

###　资源的共享及通信

Pod使Pod内的数据共享及通信变得容易

Pod的中的应用均使用相同的网络命名空间及端口，并且可以通过`localhost`发现并沟通其他应用

每个`Pod`都有一个扁平化的网络命名空间下IP地址，它是`Pod`可以和其他的物理机及其他的容器进行无障碍通信

（The hostname is set to the pod’s Name for the application containers within the pod）主机名被设置为Pod的名称

除了定义了在`Pod`中运行的应用之外，`Pod`还定义了一系列的共享的磁盘，磁盘让这些数据在容器重启的时候不回丢失并且可以将这些数据在Pod中的应用进行共享

## 管理

Pod通过提供一个高层次抽象而不是底层的接口简化了应用的部署及管理

`Pod` 作为最小的部署及管理单位，位置管理，拷贝复制，资源共享，依赖关系都是自动处理的。


## Pod的使用

Pod可以作为垂直应用整合的载体，但是它的主要特点是支持同地协作，同地管理程序

例如：

1. 内容管理系统，文件和数据加载，本地缓存等等
2. 日志和检查点备份，压缩，循环，快照等等
3. 数据交换监控，日志追踪，日志记录和监控适配器，以及事件发布等等
4. 代理，网桥，适配器
5. 控制，管理，配置，更新

总体来说，独立的Pod不会去加载多个相同的应用实例


###　为什么不直接在一个容器上运行所有的应用？

1. 透明，Pod中的容器对基础设施可见使的基础设施可以给容器提供服务

    例如线程管理和资源监控，这为用户提供很多便利,解耦软件依赖关系,独立的容器可以独立的进行重建和重新发布，`Kubernetes` 甚至会在将来支持独立容器的实时更新

2. 易用，用户不需要运行自己的线程管理器，也不需要关心程序的信号以及异常结束码等

3. 高效，因为基础设施承载了更多的责任，所以容器可以更加高效

### 为什么不支持容器的协同调度

容器的协同调度可以提供，但是它不具备`Pod`的大多数优点，比如**资源共享**，**IPC**，**选择机制**，**简单管理**等

## Pod的持久性

Pod并不是被设计成一个持久化的资源

>　它不会在调度失败，节点崩溃，或者其他回收中（比如因为资源的缺乏，或者其他的维护中）幸存下来

总体来说，用户该直接去创建`Pod`，并且一直使用`controller`(`replication controller`)

即使是一个**节点**的情况，这是因为`controller`提供了集群范围内的自我修复，以及复制还有展示管理

集群`API`的使用是用户的主要使用方式，这是相对普遍的在如下云管理平台中（ Borg, Marathon, Aurora, and Tupperware.）

###　Pod的直接暴露使如下操作变得更容器

1. 调度和管理的易用性
2. 在没有代理的情况下通过API可以对Pod进行操作
3. Pod的生命周期与管理器的生命周期的**分离**
4. 解偶控制器和服务，后段管理器仅仅监控Pod

> 划分清楚了Kubelet级别的功能与云平台级别的功能，kubelet 实际上是一个Pod管理器

高可用，当发生一些删除或者维护的过程时，Pod会自动的在他们被终止之前创建新的替代
